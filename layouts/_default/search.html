{{ define "head-end" }}
{{- $titleKey := dict "name" "title" "weight" 0.8 -}}
{{- $contentKey := dict "name" "content" "weight" 0.5 -}}
{{- $tagsKey := dict "name" "tags" "weight" 0.3 -}}
{{- $categoriesKey := dict "name" "categories" "weight" 0.3 -}}
{{- $keys := slice $titleKey $contentKey $tagsKey $categoriesKey -}}
{{- $options := dict "ignoreLocation" true "includeMatches" true "keys" $keys -}}
{{- $optionWhitelist := slice "ignoreLocation" "isCaseSensitive" "minMatchCharLength" "threshold" "distance" "useExtendedSearch" -}}
{{- with .Site.Params.search.fuse -}}
  {{- range $key, $value := . -}}
    {{- range $optionWhitelist -}}
      {{- if eq $key (lower .) -}}
        {{- $options = merge $options (dict . $value) -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
<script>
  var searchResultContentWordCount = parseInt('{{ default 240 .Site.Params.search.resultContentWordCount }}')
  var fuseOptions = JSON.parse('{{ $options | jsonify | safeHTML }}')
  console.log(fuseOptions)
</script>
{{- $script := resources.Get "js/search.js" | resources.Fingerprint -}}
<script src="{{ $script.Permalink }}" integrity="{{ $script.Data.Integrity }}" crossorigin="anonymous"></script>
{{ end }}

{{ define "content" }}
<div class="search container">
  <div class="row">
    <div class="col-md-6">
      <form class="search-form" action="{{ absLangURL "search" }}">
        <div class="input-group">
          <input class="form-control border-right-0" id="searchQuery" name="q" type="search" placeholder="{{ i18n "search" }}" aria-label="Search">
          <button class="btn-search input-group-text" type="submit"><i class="fas fa-fw fa-search"></i></button>
        </div>
      </form>
    </div>
  </div>
  <div id="searchResults" class="search-results"></div>
</div>
<script type="text/html" id="searchResultTemplate">
  <div class="search-result">
    <h2 class="search-result-title">
      <a {{ printf "href={{permalink}}" | safeHTMLAttr }}>{{ print "{{title}}" }}</a>
    </h2>
    <div class="search-result-content">{{ print "{{{content}}}" }}</div>
  </div>
</script>
{{ end }}
